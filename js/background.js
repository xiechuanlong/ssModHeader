import { S as Sd, a as Sh, _ as _d, Z as Zd, Q as Qd, k as kd, t as tv, p as ph, A as Ad, n as nh, J as Jy, b as ay, i as iy, c as cy, f as fm, d as kh, $ as $d, e as em, j as jd, O as Od, H as Hh, I as Id, E as Ed, x as xd, P as Pd, r as ra, g as en, u as uy, X as Xy, W as Wy, Y as Yy, K as Ky } from '../profile-hook-39ba154a.js';

var _=en;var T=function(e,t){return _(e,t)};async function M(e){return new Promise((t=>chrome.browserAction.setIcon(e,t)))}async function j(e){return new Promise((t=>chrome.browserAction.setBadgeText(e,t)))}async function q(e){return new Promise((t=>chrome.browserAction.setBadgeBackgroundColor(e,t)))}let V;async function F(e){T(V,e)||(V=e,await async function({icon:e,text:t,color:r}){await Promise.all([M({path:e}),j({text:t}),q({color:r})]);}(V));}var U={
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
parse:function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");var r={},o=(t||{}).decode||B,a=0;for(;a<e.length;){var n=e.indexOf("=",a);if(-1===n)break;var s=e.indexOf(";",a);if(-1===s)s=e.length;else if(s<n){a=e.lastIndexOf(";",n-1)+1;continue}var i=e.slice(a,n).trim();if(void 0===r[i]){var l=e.slice(n+1,s).trim();34===l.charCodeAt(0)&&(l=l.slice(1,-1)),r[i]=z(l,o);}a=s+1;}return r},serialize:function(e,t,r){var o=r||{},a=o.encode||W;if("function"!=typeof a)throw new TypeError("option encode is invalid");if(!N.test(e))throw new TypeError("argument name is invalid");var n=a(t);if(n&&!N.test(n))throw new TypeError("argument val is invalid");var s=e+"="+n;if(null!=o.maxAge){var i=o.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(i);}if(o.domain){if(!N.test(o.domain))throw new TypeError("option domain is invalid");s+="; Domain="+o.domain;}if(o.path){if(!N.test(o.path))throw new TypeError("option path is invalid");s+="; Path="+o.path;}if(o.expires){var l=o.expires;if(!function(e){return "[object Date]"===D.call(e)||e instanceof Date}(l)||isNaN(l.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+l.toUTCString();}o.httpOnly&&(s+="; HttpOnly");o.secure&&(s+="; Secure");if(o.priority){switch("string"==typeof o.priority?o.priority.toLowerCase():o.priority){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(o.sameSite){switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}},D=Object.prototype.toString,N=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function B(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function W(e){return encodeURIComponent(e)}function z(e,t){try{return t(e)}catch(t){return e}}var $={exports:{}},G={decodeValues:!0,map:!1,silent:!1};function J(e){return "string"==typeof e&&!!e.trim()}function X(e,t){var r=e.split(";").filter(J),o=r.shift().split("="),a=o.shift(),n=o.join("=");t=t?Object.assign({},G,t):G;try{n=t.decodeValues?decodeURIComponent(n):n;}catch(e){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+n+"'. Set options.decodeValues to false to disable this feature.",e);}var s={name:a,value:n};return r.forEach((function(e){var t=e.split("="),r=t.shift().trimLeft().toLowerCase(),o=t.join("=");"expires"===r?s.expires=new Date(o):"max-age"===r?s.maxAge=parseInt(o,10):"secure"===r?s.secure=!0:"httponly"===r?s.httpOnly=!0:"samesite"===r?s.sameSite=o:s[r]=o;})),s}function Y(e,t){if(t=t?Object.assign({},G,t):G,!e)return t.map?{}:[];if(e.headers&&e.headers["set-cookie"])e=e.headers["set-cookie"];else if(e.headers){var r=e.headers[Object.keys(e.headers).find((function(e){return "set-cookie"===e.toLowerCase()}))];r||!e.headers.cookie||t.silent||console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),e=r;}if(Array.isArray(e)||(e=[e]),(t=t?Object.assign({},G,t):G).map){return e.filter(J).reduce((function(e,r){var o=X(r,t);return e[o.name]=o,e}),{})}return e.filter(J).map((function(e){return X(e,t)}))}$.exports=Y;var K=$.exports.parse=Y;$.exports.parseString=X,$.exports.splitCookiesString=function(e){if(Array.isArray(e))return e;if("string"!=typeof e)return [];var t,r,o,a,n,s=[],i=0;function l(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(t=i,n=!1;l();)if(","===(r=e.charAt(i))){for(o=i,i+=1,l(),a=i;i<e.length&&"="!==(r=e.charAt(i))&&";"!==r&&","!==r;)i+=1;i<e.length&&"="===e.charAt(i)?(n=!0,i=a,s.push(e.substring(t,o)),t=i):i=o+1;}else i+=1;(!n||i>=e.length)&&s.push(e.substring(t,e.length));}return s};const Q="toggle_pause",Z="switch_to_profile_1",ee="switch_to_profile_2",te="switch_to_profile_3",re="switch_to_profile_4";async function oe(e,t){t<e.profiles.length&&await kd(t);}const ae=[3===chrome.runtime.getManifest().manifest_version?"action":"browser_action"],ne={};async function se(){await async function(){return new Promise((e=>chrome.contextMenus.removeAll(e)))}(),await async function(e){return new Promise((t=>chrome.contextMenus.create(e,t)))}({id:"pause",title:"Pause",contexts:ae});}async function ie(e,{title:t,onclick:r}){ne[e]!==t&&(ne[e]=t,await async function(e,t){return new Promise((r=>chrome.contextMenus.update(e,t,r)))}(e,{title:t,contexts:ae,onclick:r}));}async function le(){let e,t=await jd();if(!t.profiles){const r=await Od(),o=r?Object.keys(r):[];o.sort(),o.length>0&&(t={profiles:r[o[o.length-1]],selectedProfile:0,savedToCloud:!0},e=!0);}return Hh(t.profiles)&&(t.profiles=[]),ph(t.profiles)&&(e=!0),(Id(t.selectedProfile)||t.selectedProfile<0||t.selectedProfile>=t.profiles.length)&&(t.selectedProfile=t.profiles.length-1,e=!0),e&&await _d(t),t}function ce(e){return !e.isPaused}function ue(e,t){return e.regexEnabled?Object.keys(t).filter((t=>new RegExp(e.name,"g").test(t))):t.hasOwnProperty(e.name)?[e.name]:[]}function fe({appendMode:e,originalValue:t,newValue:r}){switch(e){case Ky.COMMA_SEPARATED_APPEND:return t?t+","+r:r;case Ky.APPEND:return t+r;default:return r}}function de(e,t,r,o){if(!r||!r.length)return;const a={};for(let e=0;e<o.length;e++){a[o[e].name.toLowerCase()]=e;}for(const t of r){const r=t.name.toLowerCase(),n=a[r];if(!t.value&&void 0!==n&&!t.sendEmptyHeader){o[n].needRemoval=!0;continue}const s=Wy({value:t.value,url:e,oldValue:void 0!==n?o[n].value:void 0});void 0!==n?o[n].value=fe({appendMode:t.appendMode,originalValue:o[n].value,newValue:s}):(o.push({name:t.name,value:s}),a[r]=o.length-1);}}function pe(e,t,r,o){if(!r||!r.length)return;const a=o.find((e=>"cookie"===e.name.toLowerCase())),n=U.parse(a?a.value:"");for(const t of r){const r=ue(t,n);0!==r.length||t.regexEnabled||(n[t.name]=Wy({value:t.value,oldValue:"",url:e}));for(const o of r)t.value||!n.hasOwnProperty(o)||t.sendEmptyHeader?n[o]=Wy({value:t.value,oldValue:n[o],url:e}):delete n[o];}const s=Object.entries(n).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("; ");if(a)a.value=s,s||(a.needRemoval=!0);else {const e={name:"cookie",value:s};s||(e.needRemoval=!0),o.push(e);}}function he(e,t,r,o){if(!r||!r.length)return;const a=[];let n={};for(let e=0;e<o.length;e++){const t=o[e];if("set-cookie"===t.name.toLowerCase()){const r=K(t.value);for(const e of r)n[e.name]=e;a.push(e);}}for(const t of r)if(t.value){const r=ue(t,n);if(0!==r.length||t.regexEnabled)for(const o of r){const r=Wy({value:t.value,oldValue:n[o].value,url:e});t.attributeOverride?n[o]={...t,value:r}:n[o].value=r;}else n[t.name]={...t,value:Wy({value:t.value,oldValue:"",url:e})};}else {const r=ue(t,n);if(r.length>0)for(const o of r)t.retainExistingCookie?n[o]={...t,value:Wy({value:n[o].value,oldValue:n[o].value,url:e})}:n[o].value="";}a.reverse();for(const[e,t]of Object.entries(n)){const r=U.serialize(e,t.value,t);if(a.length>0){o[a.pop()].value=r;}else o.push({name:"set-cookie",value:r});}}function me(e,t,r,o){if(!r||!r.length)return;let a=-1;for(let e=0;e<o.length;e++){if("content-security-policy"===o[e].name.toLowerCase()){a=e;break}}let n={};for(const e of r)n[e.name]=e.value;const s=Yy(n);a>=0?o[a].value=s:o.push({name:"content-security-policy",value:s});}var ge=function(e){return void 0===e};async function we(e){let t=await async function(){const[e,t]=await Promise.all([le(),tv()]);return t.length>0&&ph(t),e.managedProfiles=t,e}(),r=ye(t);await e(r),Ad((async o=>{const n=!ge(o.profiles);if(n){let e=o.profiles.newValue;if(ge(e)&&(e=[]),ph(e))return void await Ed(e)}for(const[e,r]of Object.entries(o))t[e]=r.newValue;(n||o.selectedProfile)&&(r=ye(t)),await e(r),n&&await async function(e){const t=await Od(),r=t?Object.keys(t):[];r.sort(),r.length>=20&&await xd(r.slice(0,r.length-20));if(0===r.length||!T(t[r[r.length-1]],e.profiles)){const t={};t[Date.now()]=e.profiles,await Pd(t);}}(t);}));}function ve(e){const t=ra(e);return t.headers=nh(t.headers),t.respHeaders=nh(t.respHeaders),t.cookieHeaders=nh(t.cookieHeaders),t.setCookieHeaders=nh(t.setCookieHeaders),t.cspHeaders=nh(t.cspHeaders),t.urlReplacements=Jy(t.urlReplacements),t.urlFilters=ay(t.urlFilters),t.excludeUrlFilters=ay(t.excludeUrlFilters),t.resourceFilters=iy(t.resourceFilters),t.tabFilters=cy(t.tabFilters),t.tabGroupFilters=cy(t.tabGroupFilters),t.windowFilters=cy(t.windowFilters),t.timeFilters=cy(t.timeFilters),t}function ye(e){const t=[];let r;if(e.managedProfiles.length>0)for(const r of e.managedProfiles){const e=ve(r);t.push(e);}if(e.profiles){const o=e.profiles;for(const[a,n]of o.entries()){if(a!==e.selectedProfile&&!n.alwaysOn)continue;const o=ve(n);a===e.selectedProfile&&(r=o),t.push(o);}}return {chromeLocal:e,activeProfiles:t,selectedActiveProfile:r}}const Pe="EXISTS",be="IMPORT",ke="IMPORT_AUTO_SYNC",xe="SWITCH_TO_LATEST",He="PROFILES";const Se={};function Le(e,t){Se[e]||chrome.webRequest[e].addListener(t.callback,t.filter,t.extraInfoSpec);}function Ae(e,t){Se[e]&&chrome.webRequest[e].removeListener(t);}fm();const Ce=["<all_urls>"];let Oe,Ee={isPaused:!0},Ie=[];function Re(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(ce(e)){let e=r.url;for(const o of t)uy({url:e,type:r.type,tabId:r.tabId,profile:o})&&(e=Xy({urlRedirects:o.urlReplacements,url:e}));if(e!==r.url)return {redirectUrl:e}}}({chromeLocal:Ee,activeProfiles:Ie,details:e})}function _e(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(ce(e)&&t.length>0){for(const e of t)uy({url:r.url,type:r.type,tabId:r.tabId,profile:e})&&(de(r.url,0,e.headers,r.requestHeaders),pe(r.url,0,e.cookieHeaders,r.requestHeaders),r.requestHeaders=r.requestHeaders.filter((e=>!e.needRemoval)));return {requestHeaders:r.requestHeaders}}}({chromeLocal:Ee,activeProfiles:Ie,details:e})}function Te(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(ce(e)&&t.length>0){const e=r.responseHeaders||[];let o;for(const a of t)uy({url:r.url,type:r.type,tabId:r.tabId,profile:a})&&(o||(o=ra(e)),de(r.url,0,a.respHeaders,o),he(r.url,0,a.setCookieHeaders,o),me(r.url,0,a.cspHeaders,o),o=o.filter((e=>!e.needRemoval)));if(o&&!T(o,e))return {responseHeaders:o}}}({chromeLocal:Ee,activeProfiles:Ie,details:e})}function Me(){Ie.find((e=>e.urlReplacements.length>0))?Le("onBeforeRequest",{callback:Re,filter:{urls:Ce},extraInfoSpec:["blocking"]}):function(e){Ae("onBeforeRequest",e);}(Re),Ie.find((e=>e.headers.length>0||e.cookieHeaders.length>0))?function(e,t){Le("onBeforeSendHeaders",{callback:e,filter:{urls:t},extraInfoSpec:["requestHeaders","blocking","extraHeaders"]});}(_e,Ce):function(e){Ae("onBeforeSendHeaders",e);}(_e),Ie.find((e=>e.respHeaders.length>0||e.setCookieHeaders.length>0||e.cspHeaders.length>0))?function(e,t){Le("onHeadersReceived",{callback:e,filter:{urls:t},extraInfoSpec:["responseHeaders","blocking","extraHeaders"]});}(Te,Ce):function(e){Ae("onHeadersReceived",e);}(Te);}async function je(e,t){const o=await async function({chromeLocal:e,request:t}){switch(console.log("Received message",t),t.type){case Pe:{const e=chrome.runtime.getManifest();return {success:!0,maxSupportedProfileVersion:em,canImportWithAutoSync:!0,modHeaderVersion:e.version}}case be:{const r=[JSON.parse(t.profile)];ph(r);const o=[...e.profiles,...r];return await $d(o,o.length-1),{success:!0}}case ke:{const r=await kh({liveProfileUrl:t.profileUrl}),o=[...e.profiles,r];return await $d(o,o.length-1),{success:!0}}case xe:return await kd(e.profiles.length-1),{success:!0};case He:return {success:!0,profiles:e.profiles,selectedProfileIndex:e.selectedProfile,managedProfiles:e.managedProfiles};default:return}}({chromeLocal:Ee,request:e});o&&t(o);}chrome.runtime.onMessageExternal.addListener((async(e,t,r)=>{!t.origin||t.origin.startsWith("https://modheader.com")?await je(e,r):r({error:"Unsupported origin"});})),chrome.commands.onCommand.addListener((async e=>{await async function(e,r){switch(r){case Q:await Sd(!e.isPaused);break;case Z:await oe(e,0);break;case ee:await oe(e,1);break;case te:await oe(e,2);break;case re:await oe(e,3);}}(Ee,e);})),chrome.alarms.onAlarm.addListener((async e=>{"checkLiveProfileAlarm"===e.name&&!Ee.isPaused&&Ee.profiles&&await Sh(Ee.profiles);})),window.saveToStorage=function(e){return _d(e)},async function(){await Zd(),await se(),await we((async e=>{Ee=e.chromeLocal,Ie=e.activeProfiles,Oe=e.selectedActiveProfile,Me(),await async function({chromeLocal:e,activeProfiles:t,selectedActiveProfile:r}){if(e.isPaused)await F({icon:"images/icon_bw.png",text:"❚❚",color:"#666"});else {let e=0;for(const r of t)e+=r.headers.length+r.respHeaders.length+r.cookieHeaders.length+r.setCookieHeaders.length+r.cspHeaders.length+r.urlReplacements.length;0===e?await F({icon:"images/icon_bw.png",text:"",color:"#fff"}):await F({icon:"images/icon.png",text:e.toString(),color:r.backgroundColor});}}({chromeLocal:Ee,activeProfiles:Ie,selectedActiveProfile:Oe}),await async function(e){e.isPaused?await ie("pause",{title:"Unpause ModHeader",onclick:()=>Sd(!1)}):await ie("pause",{title:"Pause ModHeader",onclick:()=>Sd(!0)});}(Ee);})),chrome.alarms.create("checkLiveProfileAlarm",{periodInMinutes:30,when:1});}(),chrome.runtime.onInstalled.addListener((e=>{"install"===e.reason&&setTimeout((()=>{Ee.managedProfiles&&0!==Ee.managedProfiles.length||Qd({path:"/modheader/welcome",autoClose:!1});}),1e3);}));
